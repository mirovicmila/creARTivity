<% include ../views/partials/header %>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
<script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=S8d7L47mdyAG5nHG09dUnSPJjreUVPeC"></script>
<script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-routing.js?key=S8d7L47mdyAG5nHG09dUnSPJjreUVPeC"></script>
<script src="https://api.mqcdn.com/sdk/place-search-js/v1.0.0/place-search.js"></script>
<link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/place-search-js/v1.0.0/place-search.css"/>

<div class="container-lg container-fluid">
  <div class="d-inline-flex justify-content-around">
    <h1 class="display-1 align-self-center">Museums</h1>
    <img src="https://i.imgur.com/Xc3EV8o.png" class="img-fluid w-50 p-3" alt="Responsive image">
  </div>

<p class="lead">
  Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor. Duis mollis, est non commodo luctus.
</p>

<div class="row">
  <% muzeji.forEach(function(muzej){ %>
  <div class="card text-white bg-info mb-3 mx-auto" style="width: 18rem;">
    <div class="card-body">
      <i class="fa fa-university"></i>
      <h5 class="card-title"><%= muzej.name %></h5>
      <h6 class="card-subtitle mb-2 text-muted"><%= muzej.address %></h6>
      <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      <a href="/museum/<%=muzej.id%>"><%= muzej.name %></a>
    </div>
  </div>
  <% }) %>
</div>
<h3>Pieces</h3>
<div class="row">
  <% dela.forEach(function(delo){ %>
  <div class="col-md-2">
    <div class="card">
      <i class="fa fa-paint-brush"></i
      ><a href="/piece/<%=delo.id%>"><%= delo.name%></a>
    </div>
  </div>
  <% }) %>
</div>
<h3>Find a path between museums</h3>
<style>
  #map {
      width: 900px;
      height:400px;
  }
</style>    
<br/>

<div class="formBlock">
  <form id="form">
      <input type="search" name="prviMuzej" class="input" id="prviMuzej" placeholder="Choose starting museum" />
      <input type="search" name="drugiMuzej" class="input" id="drugiMuzej" placeholder="Choose end museum" />
      <button  type="submit">Get Route</button>
  </form>
</div>
<div id="map"></div>  
</div>     
<script>
var map = L.map('map', {
  //center: latLng,
  layers: MQ.mapLayer(),
  center: [ 48.208182356298806, 16.375101576566305],
  //layers: L.mapquest.tileLayer('map'),
  zoom: 14
});
</script>
<script type="text/javascript">
  function iscrtajPut(prviMuzej,drugiMuzej){
  
    //L.mapquest.key = 'xZkpUhDeKCi3xZfhJVuTc52uc7s6tjN9';   
      var map = L.map('map', {
        //center: latLng,
        layers: MQ.mapLayer(),
        center: [ 48.208182356298806, 16.375101576566305 ],
        //layers: L.mapquest.tileLayer('map'),
        zoom: 14
      });
      dir = MQ.routing.directions();

dir.route({
  locations: [
  //'Belvedere Palace, Prinz Eugen-Stra√üe, Vienna, Austria',
  //'Albertina, Albertinaplatz, Vienna, Austria',
  prviMuzej,
  drugiMuzej
  ]
});
CustomRouteLayer = MQ.Routing.RouteLayer.extend({
                  createStartMarker: function (location, stopNumber) {
                      var custom_icon;
                      var marker;

                      custom_icon = L.icon({
                          iconUrl: 'https://www.mapquestapi.com/staticmap/geticon?uri=poi-red_1.png',
                          iconSize: [20, 29],
                          iconAnchor: [10, 29],
                          popupAnchor: [0, -29]
                      });

                      marker = L.marker(location.latLng, {icon: custom_icon}).addTo(map);

                      return marker;
                  },

                  createEndMarker: function (location, stopNumber) {
                      var custom_icon;
                      var marker;

                      custom_icon = L.icon({
                          iconUrl: 'https://www.mapquestapi.com/staticmap/geticon?uri=poi-blue_1.png',
                          iconSize: [20, 29],
                          iconAnchor: [10, 29],
                          popupAnchor: [0, -29]
                      });

                      marker = L.marker(location.latLng, {icon: custom_icon}).addTo(map);

                      return marker;
                  }
              });

              map.addLayer(new CustomRouteLayer({
                  directions: dir,
                  fitBounds: true
              }));
          
    }
</script> 
<script>
  function submitForm(event) {
    event.preventDefault();

    // delete current map layer
    map.remove();

    // getting form data
    prviMuzej = document.getElementById("prviMuzej").value;
    drugiMuzej = document.getElementById("drugiMuzej").value;

    // run directions function
    iscrtajPut(prviMuzej, drugiMuzej);

    // reset form
    document.getElementById("form").reset();
}

// asign the form to form variable
const form = document.getElementById('form');

// call the submitForm() function when submitting the form
form.addEventListener('submit', submitForm);
</script>
